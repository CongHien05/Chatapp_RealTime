BankingRMI â€“ HÆ°á»›ng dáº«n há»c code
================================

1. MÃ´ hÃ¬nh tá»•ng quan
--------------------
- Project mÃ´ phá»ng há»‡ thá»‘ng eBanking Ä‘Æ¡n giáº£n sá»­ dá»¥ng Java RMI (Remote Method Invocation).
- RMI cho phÃ©p client gá»i trá»±c tiáº¿p cÃ¡c method trÃªn server giá»‘ng nhÆ° gá»i hÃ m cá»¥c bá»™.
- Káº¿t ná»‘i gá»“m 2 luá»“ng chÃ­nh:
  1. Client gá»i `IBanking` trÃªn server Ä‘á»ƒ thá»±c hiá»‡n giao dá»‹ch.
  2. Server Ä‘áº©y thÃ´ng bÃ¡o ngÆ°á»£c vá» client qua interface `IClientCallback`.

2. Cáº¥u trÃºc thÆ° má»¥c chÃ­nh
-------------------------
- `src/common`: Chá»©a cÃ¡c interface dÃ¹ng chung giá»¯a client vÃ  server.
  - `IBanking`: Äá»‹nh nghÄ©a cÃ¡c nghiá»‡p vá»¥ (váº¥n tin, náº¡p, rÃºt, chuyá»ƒn, Ä‘Äƒng kÃ½ callback).
  - `IClientCallback`: Cho phÃ©p server gá»i ngÆ°á»£c láº¡i client Ä‘á»ƒ gá»­i thÃ´ng bÃ¡o.
- `src/server`: Code cháº¡y phÃ­a server.
  - `BankingImpl`: Implement `IBanking`, giá»¯ dá»¯ liá»‡u tÃ i khoáº£n vÃ  xá»­ lÃ½ giao dá»‹ch.
  - `Server`: Khá»Ÿi táº¡o `BankingImpl`, má»Ÿ RMI registry port 1099, bind tÃªn `BankingService`.
- `src/client`: Code cháº¡y phÃ­a client.
  - `ClientServiceImpl`: Implement `IClientCallback`, giá»¯ logic gá»i server vÃ  cáº­p nháº­t GUI.
  - `ClientGUI`: Giao diá»‡n Swing, gá»i `ClientServiceImpl` Ä‘á»ƒ thá»±c thi hÃ nh Ä‘á»™ng ngÆ°á»i dÃ¹ng.
- `accounts.txt`: File dá»¯ liá»‡u Ä‘Æ¡n giáº£n lÆ°u STK vÃ  sá»‘ dÆ° (Ä‘á»‹nh dáº¡ng `accountId,balance`).

3. TrÃ¬nh tá»± hoáº¡t Ä‘á»™ng chi tiáº¿t
------------------------------
1. Khá»Ÿi Ä‘á»™ng server (`server.Server`):
   - **Táº¡o Ä‘á»‘i tÆ°á»£ng dá»‹ch vá»¥**: `new BankingImpl()` â†’ trong constructor Ä‘á»c dá»¯ liá»‡u tÃ i khoáº£n, khá»Ÿi táº¡o `accounts` vÃ  `clientMap`.
   - **Náº¡p dá»¯ liá»‡u**: `loadAccounts()` quÃ©t file `accounts.txt`, má»—i dÃ²ng `accountId,balance` Ä‘Æ°á»£c Ä‘Æ°a vÃ o Map; console log Ä‘á»ƒ ngÆ°á»i nghe tháº¥y server thá»±c sá»± â€œÄ‘ang loadâ€.
   - **Xuáº¥t báº£n dá»‹ch vá»¥**: `LocateRegistry.createRegistry(1099)` báº£o Ä‘áº£m registry tá»“n táº¡i rá»“i `registry.bind("BankingService", bankingService)`; nháº¥n máº¡nh tÃªn nÃ y chÃ­nh lÃ  â€œendpointâ€ client sáº½ lookup.
   - **Káº¿t luáº­n bÆ°á»›c**: console in `>>> Server is running...` â†’ slide cÃ³ thá»ƒ show screenshot log Ä‘á»ƒ kháº³ng Ä‘á»‹nh server Ä‘Ã£ sáºµn sÃ ng.
2. Khá»Ÿi cháº¡y client (`client.ClientGUI`):
   - **Thu tháº­p Ä‘áº§u vÃ o**: `JOptionPane.showInputDialog` yÃªu cáº§u ngÆ°á»i dÃ¹ng nháº­p sá»‘ tÃ i khoáº£n; náº¿u bá» trá»‘ng thÃ¬ thoÃ¡t â†’ chá»©ng tá» UI cÃ³ kiá»ƒm soÃ¡t ngay tá»« Ä‘áº§u.
   - **Táº¡o service riÃªng cho user**: `new ClientServiceImpl(accountId)` giá»¯ háº³n `accountId` vÃ  chuáº©n bá»‹ nháº­n callback.
   - **Gáº¯n GUI**: constructor `ClientGUI(service)` gá»i `service.setGUI(this)` â†’ service biáº¿t Ä‘Æ°á»ng cáº­p nháº­t giao diá»‡n.
   - **Káº¿t ná»‘i ná»n**: táº¡o thread gá»i `service.connectToServer()` Ä‘á»ƒ trÃ¡nh "Ä‘Æ¡" UI; trong method nÃ y:
     * `Naming.lookup("BankingService")` láº¥y STUB tá»« registry (stub lÃ  proxy object Ä‘áº¡i diá»‡n cho BankingImpl trÃªn server, Ä‘Æ°á»£c RMI tá»± Ä‘á»™ng táº¡o khi server bind; xem file RMI_STUB_EXPLANATION.txt Ä‘á»ƒ hiá»ƒu chi tiáº¿t).
     * `registerClient(accountId, this)` Ä‘Äƒng kÃ½ callback â†’ server lÆ°u client vÃ o `clientMap`.
     * `checkBalance()` Ä‘Æ°á»£c gá»i ngay Ä‘á»ƒ kÃ©o sá»‘ dÆ° Ä‘áº§u tiÃªn lÃªn giao diá»‡n.
   - **Káº¿t luáº­n**: sau bÆ°á»›c 2, client Ä‘Ã£ hiá»‡n cá»­a sá»•, cÃ³ sá»‘ dÆ° ban Ä‘áº§u vÃ  sáºµn sÃ ng thao tÃ¡c.
3. NgÆ°á»i dÃ¹ng thao tÃ¡c trÃªn GUI:
   - **Thread-safe UI**: má»—i `ActionListener` táº¡o thread riÃªng (vÃ­ dá»¥ `new Thread(() -> service.deposit(...)).start()`), báº¡n cÃ³ thá»ƒ nháº¥n máº¡nh Ä‘iá»u nÃ y giÃºp demo khÃ´ng bá»‹ â€œÄ‘Æ¡â€.
   - **Kiá»ƒm tra Ä‘áº§u vÃ o**: `ClientServiceImpl` Ä‘áº£m báº£o sá»‘ tiá»n > 0, tÃ i khoáº£n nháº­n khÃ´ng trá»‘ng vÃ  khÃ´ng trÃ¹ng tÃ i khoáº£n nguá»“n; thuyáº¿t trÃ¬nh nÃªn Ä‘á»c lÆ°á»›t qua block `if` Ä‘á»ƒ ngÆ°á»i nghe tháº¥y tÃ­nh â€œan toÃ nâ€.
   - **Gá»i dá»‹ch vá»¥ tá»« xa**: tÃ¹y nÃºt, service sáº½ gá»i `checkBalance`, `deposit`, `withdraw`, `transfer` trÃªn server; GUI ghi log (â€œNáº¡p tiá»n XX thÃ nh cÃ´ng...â€) Ä‘á»ƒ minh há»a ngÆ°á»i dÃ¹ng luÃ´n cÃ³ feedback.
4. Server xá»­ lÃ½ nghiá»‡p vá»¥:
   - **Validate & cáº­p nháº­t**: má»—i method trong `BankingImpl` kiá»ƒm tra sá»± tá»“n táº¡i tÃ i khoáº£n, sá»‘ dÆ° Ä‘á»§ hay chÆ°a; náº¿u á»•n sáº½ cáº­p nháº­t Map.
   - **Persist**: sau khi Map thay Ä‘á»•i, gá»i `saveAccounts()` (Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u `synchronized`) Ä‘á»ƒ ghi toÃ n bá»™ dá»¯ liá»‡u ra `accounts.txt` â†’ Ä‘áº£m báº£o náº¿u restart server thÃ¬ sá»‘ dÆ° váº«n giá»¯ nguyÃªn.
   - **Gá»­i thÃ´ng bÃ¡o**: riÃªng `transfer`, sau khi cáº­p nháº­t sá»‘ dÆ° hai tÃ i khoáº£n, server tÃ¬m `clientMap.get(toAccountId)`; náº¿u ngÆ°á»i nháº­n Ä‘ang online thÃ¬ gá»i `notify()` Ä‘á»ƒ há» tháº¥y popup â€œBáº¡n vá»«a nháº­n...â€.
   - **Logging**: má»i hÃ nh Ä‘á»™ng Ä‘Æ°á»£c `System.out.println` (â€œDEPOSITâ€, â€œWITHDRAWâ€, â€œTRANSFER...â€), giÃºp báº¡n trÃ¬nh bÃ y kÃ¨m log console cho trá»±c quan.
5. Client nháº­n pháº£n há»“i:
   - **Tráº£ vá» tá»©c thÃ¬**: káº¿t quáº£ true/false tá»« server giÃºp client cáº­p nháº­t log/sá»‘ dÆ° ngay khi ngÆ°á»i dÃ¹ng vá»«a báº¥m nÃºt.
   - **Callback realtime**: khi `notify` Ä‘Æ°á»£c gá»i, `ClientServiceImpl` hiá»‡n thÃ´ng bÃ¡o, ghi log â€œTHÃ”NG BÃO: ...â€, sau Ä‘Ã³ gá»i `checkBalance()` láº§n ná»¯a Ä‘á»ƒ refresh sá»‘ dÆ° â†’ ngÆ°á»i nghe hiá»ƒu rÃµ vÃ¬ sao sá»‘ dÆ° trÃªn GUI luÃ´n chÃ­nh xÃ¡c.
   - **UI thread-safety**: `ClientGUI` dÃ¹ng `SwingUtilities.invokeLater` trong má»i method update UI, báº¡n cÃ³ thá»ƒ nháº¥n máº¡nh Ä‘iá»u nÃ y khi show code Ä‘á»ƒ chá»©ng minh há»‡ thá»‘ng khÃ´ng bá»‹ â€œcross-threadâ€ lá»—i.

4. PhÃ¢n tÃ­ch tá»«ng thÃ nh pháº§n
----------------------------
- `IBanking` (`src/common/IBanking.java`)
  - Äá»‹nh nghÄ©a rÃµ há»£p Ä‘á»“ng giá»¯a client vÃ  server. Má»i method Ä‘á»u `throws RemoteException` vÃ¬ liÃªn quan RMI.
- `IClientCallback` (`src/common/IClientCallback.java`)
  - Server sá»­ dá»¥ng interface nÃ y Ä‘á»ƒ gá»­i thÃ´ng bÃ¡o realtime cho client (vÃ­ dá»¥ nháº­n tiá»n chuyá»ƒn khoáº£n).
- `BankingImpl` (`src/server/BankingImpl.java`)
  - Thuá»™c lá»›p `UnicastRemoteObject` Ä‘á»ƒ tá»± Ä‘á»™ng xuáº¥t báº£n Ä‘á»‘i tÆ°á»£ng RMI.
  - Giá»¯ `Map<String, Double> accounts` vÃ  `Map<String, IClientCallback> clientMap`.
  - `loadAccounts()` Ä‘á»c file, `saveAccounts()` ghi file Ä‘á»“ng bá»™.
  - CÃ¡c nghiá»‡p vá»¥:
    * `checkBalance`: Tráº£ vá» chuá»—i Ä‘á»‹nh dáº¡ng `%,.0f VND`.
    * `deposit`/`withdraw`: Kiá»ƒm tra Ä‘iá»u kiá»‡n, cáº­p nháº­t Map, lÆ°u file.
    * `transfer`: Kiá»ƒm tra tÃ i khoáº£n, sá»‘ dÆ°, ngÄƒn chuyá»ƒn cho chÃ­nh mÃ¬nh, cáº­p nháº­t 2 tÃ i khoáº£n vÃ  gá»i callback ngÆ°á»i nháº­n.
  - `registerClient`: LÆ°u láº¡i Ä‘á»‘i tÆ°á»£ng callback theo `accountId` Ä‘á»ƒ cÃ³ thá»ƒ gá»­i notify.
- `Server` (`src/server/Server.java`)
  - Táº¡o RMI registry ngay trong code báº±ng `LocateRegistry.createRegistry(1099)`.
  - Bind `BankingImpl` báº±ng tÃªn `BankingService` -> client lookup theo tÃªn nÃ y.
- `ClientServiceImpl` (`src/client/ClientServiceImpl.java`)
  - CÅ©ng extends `UnicastRemoteObject` Ä‘á»ƒ server cÃ³ thá»ƒ gá»i ngÆ°á»£c láº¡i.
  - Quáº£n lÃ½ káº¿t ná»‘i: `connectToServer()` gá»i `Naming.lookup("BankingService")`, Ä‘Äƒng kÃ½ callback vÃ  váº¥n tin sá»‘ dÆ° ban Ä‘áº§u.
  - Xá»­ lÃ½ nghiá»‡p vá»¥ phÃ­a client:
    * Validate input (sá»‘ tiá»n > 0, tÃ i khoáº£n nháº­n khÃ¡c rá»—ng, khÃ´ng chuyá»ƒn cho chÃ­nh mÃ¬nh).
    * Gá»i server tÆ°Æ¡ng á»©ng.
    * Ghi log, cáº­p nháº­t GUI, hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i khi cáº§n.
  - `notify`: nháº­n message tá»« server, gá»i `gui.showNotification` vÃ  `checkBalance()` Ä‘á»ƒ cáº­p nháº­t sá»‘ dÆ°.
- `ClientGUI` (`src/client/ClientGUI.java`)
  - Táº¡o form Swing vá»›i cÃ¡c nÃºt Váº¥n tin, Náº¡p tiá»n, RÃºt tiá»n, Chuyá»ƒn khoáº£n.
  - Má»—i action cháº¡y trÃªn thread riÃªng -> trÃ¡nh treo UI khi gá»i RMI.
  - Cung cáº¥p cÃ¡c helper Ä‘á»ƒ hiá»ƒn thá»‹ sá»‘ dÆ°, log, popup thÃ´ng bÃ¡o/lá»—i/cáº£nh bÃ¡o.

5. CÃ¡ch Ä‘á»c vÃ  thá»­ nghiá»‡m project (khÃ´ng dÃ¹ng terminal)
------------------------------------------------------
1. Má»Ÿ project báº±ng IDE há»— trá»£ Java (IntelliJ IDEA, Eclipseâ€¦).
2. Táº¡o hai cáº¥u hÃ¬nh cháº¡y (Run Configuration):
   - `Server`: lá»›p chÃ­nh `server.Server`.
   - `Client`: lá»›p chÃ­nh `client.ClientGUI`.
3. Quy trÃ¬nh thá»­:
   - Run cáº¥u hÃ¬nh `Server` trÆ°á»›c, quan sÃ¡t console hiá»ƒn thá»‹ `>>> Server is running...`.
   - Run má»™t hoáº·c nhiá»u `Client`. Má»—i client nháº­p sá»‘ tÃ i khoáº£n cÃ³ trong `accounts.txt`.
   - Thá»±c hiá»‡n cÃ¡c giao dá»‹ch trÃªn GUI, theo dÃµi log vÃ  cáº­p nháº­t sá»‘ dÆ°.
   - Thá»­ chuyá»ƒn khoáº£n giá»¯a 2 client khÃ¡c nhau Ä‘á»ƒ tháº¥y callback thÃ´ng bÃ¡o realtime.
4. Khi muá»‘n cáº­p nháº­t dá»¯ liá»‡u máº«u, chá»‰nh sá»­a `accounts.txt` theo dáº¡ng `accountId,balance` (má»—i dÃ²ng má»™t tÃ i khoáº£n).

6. Gá»£i Ã½ há»c sÃ¢u hÆ¡n
-------------------
- Thá»­ thay `HashMap` báº±ng `ConcurrentHashMap` Ä‘á»ƒ an toÃ n khi nhiá»u client truy cáº­p Ä‘á»“ng thá»i.
- Bá»• sung xÃ¡c thá»±c Ä‘Äƒng nháº­p (vÃ­ dá»¥ thÃªm máº­t kháº©u trong file).
- ThÃªm lá»‹ch sá»­ giao dá»‹ch, Ä‘á»“ng bá»™ hÃ³a giao diá»‡n Ä‘áº¹p hÆ¡n, hoáº·c chuyá»ƒn sang JavaFX.
- NÃ¢ng cáº¥p tá»« file sang cÆ¡ sá»Ÿ dá»¯ liá»‡u (MySQL, PostgreSQL) vÃ  dÃ¹ng DAO.
- Thá»­ Ä‘Ã³ng gÃ³i thÃ nh module Maven/Gradle Ä‘á»ƒ quáº£n lÃ½ dependency tá»‘t hÆ¡n.

7. Ká»‹ch báº£n demo & trÃ¬nh bÃ y code
---------------------------------
1. **Giá»›i thiá»‡u nhanh kiáº¿n trÃºc**
   - Má»Ÿ sÆ¡ Ä‘á»“ thÆ° má»¥c, nháº¥n máº¡nh 3 lá»›p `common`, `server`, `client`.
   - Váº½ (hoáº·c dÃ¹ng slide) mÃ´ táº£ 2 chiá»u giao tiáº¿p: client â†’ server (giao dá»‹ch) vÃ  server â†’ client (callback).
2. **Demo cháº¡y thá»±c táº¿**
   - BÆ°á»›c 1: Run `server.Server`, chá»‰ ra log â€œ`>>> Server is running...`â€.
   - BÆ°á»›c 2: Run `client.ClientGUI` vá»›i tÃ i khoáº£n `1001`, trÃ¬nh diá»…n váº¥n tin vÃ  náº¡p tiá»n.
   - BÆ°á»›c 3: Run thÃªm má»™t client khÃ¡c (tÃ i khoáº£n `1002`), thá»±c hiá»‡n chuyá»ƒn khoáº£n tá»« `1001` sang `1002`.
   - Highlight: Client `1002` nháº­n popup thÃ´ng bÃ¡o qua callback; log cáº­p nháº­t á»Ÿ cáº£ hai phÃ­a.
3. **Äi sÃ¢u vÃ o code khi trÃ¬nh bÃ y**
   - Má»Ÿ `IBanking` Ä‘á»ƒ giáº£i thÃ­ch há»£p Ä‘á»“ng dá»‹ch vá»¥ â†’ liÃªn há»‡ vá»›i cÃ¡c nÃºt trÃªn GUI.
   - Chuyá»ƒn sang `BankingImpl.transfer()`: vá»«a xá»­ lÃ½ nghiá»‡p vá»¥, vá»«a gá»i `recipientClient.notify`.
   - Má»Ÿ `ClientServiceImpl.notify()` & `ClientGUI.showNotification()` Ä‘á»ƒ tháº¥y Ä‘Æ°á»ng Ä‘i cá»§a thÃ´ng bÃ¡o.
   - Nháº¥n máº¡nh `saveAccounts()` giÃºp dá»¯ liá»‡u bá»n vá»¯ng giá»¯a cÃ¡c láº§n cháº¡y, cho tháº¥y demo reset váº«n giá»¯ sá»‘ dÆ°.
4. **Chá»‘t láº¡i sau demo**
   - TÃ³m táº¯t Æ°u Ä‘iá»ƒm: kiáº¿n trÃºc rÃµ rÃ ng, há»— trá»£ multi-client, cÃ³ callback realtime.
   - Äá» xuáº¥t hÆ°á»›ng phÃ¡t triá»ƒn (tham chiáº¿u má»¥c 6) Ä‘á»ƒ thá»ƒ hiá»‡n táº§m nhÃ¬n.

8. Flow â€œtrÃ¬nh bÃ y code siÃªu mÆ°á»£tâ€
----------------------------------
- **Má»Ÿ cáº£nh**  
  â€œChÃºng ta cÃ³ má»™t há»‡ thá»‘ng eBanking RMI nhá» gá»n gá»“m 3 layer: `common` Ä‘á»‹nh nghÄ©a há»£p Ä‘á»“ng, `server` cÃ i Ä‘áº·t nghiá»‡p vá»¥, `client` hiá»ƒn thá»‹ GUI vÃ  gá»i dá»‹ch vá»¥.â€
- **Äi vÃ o há»£p Ä‘á»“ng chung**  
  1. Má»Ÿ `IBanking`: â€œÄÃ¢y lÃ  API mÃ  client gá»i â€“ má»—i method map 1 thao tÃ¡c trÃªn UI.â€  
  2. Má»Ÿ `IClientCallback`: â€œHá»£p Ä‘á»“ng chiá»u ngÆ°á»£c láº¡i Ä‘á»ƒ server báº¯n thÃ´ng bÃ¡o realtime.â€
- **Chuyá»ƒn sang server**  
  1. `BankingImpl` constructor: â€œTáº£i dá»¯ liá»‡u tá»« `accounts.txt`, táº¡o kho tÃ i khoáº£n vÃ  danh sÃ¡ch client online.â€  
  2. `loadAccounts()` & `saveAccounts()`: nháº¥n máº¡nh persistence vÃ  synchronized.  
  3. `checkBalance` â†’ `deposit` â†’ `withdraw`: lÆ°á»›t nhanh, chá»‰ ra validate + cáº­p nháº­t file.  
  4. `transfer`: dá»«ng lÃ¢u hÆ¡n, highlight chá»‘ng chuyá»ƒn cho chÃ­nh mÃ¬nh, cáº­p nháº­t 2 tÃ i khoáº£n, sau Ä‘Ã³ gá»i callback â†’ liÃªn há»‡ láº¡i `IClientCallback`.  
  5. `registerClient`: â€œMá»—i láº§n client Ä‘Äƒng kÃ½, server giá»¯ báº£n Ä‘á»“ `accountId` â†” callback Ä‘á»ƒ báº¯n notify.â€
- **HoÃ n thiá»‡n server runtime**  
  Má»Ÿ `Server.java`: â€œÄÃ¢y lÃ  Ä‘iá»ƒm vÃ o, táº¡o `BankingImpl`, má»Ÿ registry port 1099, bind `BankingService`. Demo console: `>>> Server is running...`.â€
- **Äá»•i gÃ³c nhÃ¬n sang client**  
  1. `ClientGUI.main`: â€œÄÄƒng nháº­p, khá»Ÿi táº¡o `ClientServiceImpl`, cháº¡y GUI vÃ  luá»“ng káº¿t ná»‘i.â€  
  2. `ClientServiceImpl.connectToServer`: â€œLookup tÃªn `BankingService`, Ä‘Äƒng kÃ½ callback â†’ chÃ­nh lÃ  bÆ°á»›c server lÆ°u chÃºng ta vÃ o `clientMap`.â€  
  3. Giáº£i thÃ­ch `checkBalance/deposit/withdraw/transfer`: kiá»ƒm tra input, gá»i server, cáº­p nháº­t GUI.  
  4. `notify`: â€œKhi server gá»i, client show popup vÃ  tá»± váº¥n tin láº¡i â†’ user luÃ´n tháº¥y sá»‘ dÆ° má»›i nháº¥t.â€  
  5. LiÃªn há»‡ vá»›i UI: má»Ÿ `ClientGUI` highlight cÃ¡c nÃºt cháº¡y trÃªn thread riÃªng, Ä‘áº£m báº£o UI khÃ´ng bá»‹ khÃ³a.
- **Káº¿t láº¡i flow**  
  â€œNhÆ° váº­y, tá»« há»£p Ä‘á»“ng chung â†’ triá»ƒn khai server â†’ Ä‘iá»ƒm vÃ o server â†’ client GUI â†’ callback, ta Ä‘Ã£ Ä‘i trá»n vÃ²ng Ä‘á»i 1 giao dá»‹ch mÃ  khÃ´ng bá» sÃ³t máº¯t xÃ­ch nÃ o.â€

9. Táº¡i sao validate á»Ÿ cáº£ Client VÃ€ Server?
------------------------------------------
**CÃ¢u há»i thÆ°á»ng gáº·p**: "Táº¡i sao khÃ´ng validate á»Ÿ server luÃ´n, bá» validate á»Ÿ client Ä‘i?"

**Tráº£ lá»i ngáº¯n gá»n**: 
- Validate á»Ÿ CLIENT = UX tá»‘t (pháº£n há»“i nhanh, khÃ´ng cáº§n gá»i server)
- Validate á»Ÿ SERVER = Báº®T BUá»˜C (security, client cÃ³ thá»ƒ bá»‹ hack/bypass)

**Giáº£i thÃ­ch chi tiáº¿t**:

1. **Validate á»Ÿ Client (ClientServiceImpl)**:
   - Má»¥c Ä‘Ã­ch: Cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng (UX)
   - Lá»£i Ã­ch:
     * Pháº£n há»“i tá»©c thÃ¬: NgÆ°á»i dÃ¹ng biáº¿t lá»—i ngay khi nháº­p sai (vÃ­ dá»¥: sá»‘ tiá»n <= 0)
     * Giáº£m táº£i server: KhÃ´ng cáº§n gá»­i request máº¡ng cho dá»¯ liá»‡u sai
     * Tiáº¿t kiá»‡m bÄƒng thÃ´ng: TrÃ¡nh gá»i RMI khÃ´ng cáº§n thiáº¿t
   - VÃ­ dá»¥ trong code:
     * `deposit()`: Kiá»ƒm tra `amount <= 0` â†’ show warning ngay, khÃ´ng gá»i server
     * `transfer()`: Kiá»ƒm tra `toAccount.isEmpty()`, `toAccount.equals(accountId)` â†’ bÃ¡o lá»—i ngay
   - âš ï¸ LÆ¯U Ã: Client validation KHÃ”NG Ä‘áº£m báº£o an toÃ n vÃ¬:
     * Code client cÃ³ thá»ƒ bá»‹ reverse engineer
     * Hacker cÃ³ thá»ƒ táº¡o client giáº£, bá» qua validation
     * Network cÃ³ thá»ƒ bá»‹ intercept vÃ  modify request

2. **Validate á»Ÿ Server (BankingImpl)** - QUAN TRá»ŒNG NHáº¤T:
   - Má»¥c Ä‘Ã­ch: Báº£o máº­t vÃ  Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n dá»¯ liá»‡u
   - Lá»£i Ã­ch:
     * Báº£o vá»‡ dá»¯ liá»‡u: Server lÃ  nÆ¡i duy nháº¥t Ä‘Ã¡ng tin cáº­y
     * Chá»‘ng táº¥n cÃ´ng: DÃ¹ client bá»‹ hack, server váº«n kiá»ƒm tra láº¡i
     * Äáº£m báº£o nghiá»‡p vá»¥: Logic nghiá»‡p vá»¥ pháº£i Ä‘Æ°á»£c thá»±c thi Ä‘Ãºng
   - VÃ­ dá»¥ trong code:
     * `deposit()`: Kiá»ƒm tra `!accounts.containsKey(accountId) || amount <= 0`
     * `withdraw()`: Kiá»ƒm tra sá»‘ dÆ° Ä‘á»§ (`currentBalance < amount`)
     * `transfer()`: Kiá»ƒm tra cáº£ 2 tÃ i khoáº£n tá»“n táº¡i, sá»‘ dÆ° Ä‘á»§, khÃ´ng chuyá»ƒn cho chÃ­nh mÃ¬nh
   - âœ… ÄÃ¢y lÃ  lá»›p phÃ²ng thá»§ cuá»‘i cÃ¹ng, KHÃ”NG THá»‚ Bá» QUA

3. **Best Practice - Defense in Depth (PhÃ²ng thá»§ nhiá»u lá»›p)**:
   ```
   User Input â†’ [Client Validation] â†’ Network â†’ [Server Validation] â†’ Business Logic â†’ Database
                â†‘ UX tá»‘t, nhanh        â†‘ Báº®T BUá»˜C, an toÃ n
   ```
   - Client validation = Lá»›p Ä‘áº§u tiÃªn (filter sá»›m, UX tá»‘t)
   - Server validation = Lá»›p cuá»‘i cÃ¹ng (báº£o máº­t, khÃ´ng thá»ƒ bypass)

4. **So sÃ¡nh validation hiá»‡n táº¡i trong code**:
   
   **Client (ClientServiceImpl)**:
   - âœ… Kiá»ƒm tra `amount <= 0` (deposit, withdraw, transfer)
   - âœ… Kiá»ƒm tra `toAccount.isEmpty()` (transfer)
   - âœ… Kiá»ƒm tra `toAccount.equals(accountId)` (transfer)
   - âŒ KHÃ”NG kiá»ƒm tra tÃ i khoáº£n tá»“n táº¡i (pháº£i gá»i server má»›i biáº¿t)
   - âŒ KHÃ”NG kiá»ƒm tra sá»‘ dÆ° Ä‘á»§ (pháº£i gá»i server má»›i biáº¿t)
   
   **Server (BankingImpl)**:
   - âœ… Kiá»ƒm tra tÃ i khoáº£n tá»“n táº¡i (`accounts.containsKey`)
   - âœ… Kiá»ƒm tra `amount <= 0`
   - âœ… Kiá»ƒm tra sá»‘ dÆ° Ä‘á»§ (`currentBalance < amount`)
   - âœ… Kiá»ƒm tra khÃ´ng chuyá»ƒn cho chÃ­nh mÃ¬nh (`fromAccountId.equals(toAccountId)`)
   - âš ï¸ CÃ“ THá»‚ Cáº¢I THIá»†N: ThÃªm kiá»ƒm tra `toAccountId` null/empty rÃµ rÃ ng hÆ¡n

5. **Cáº£i thiá»‡n cÃ³ thá»ƒ thá»±c hiá»‡n**:
   - Server nÃªn validate Ä‘áº§y Ä‘á»§ hÆ¡n:
     ```java
     // Trong BankingImpl.transfer()
     if (toAccountId == null || toAccountId.trim().isEmpty()) {
         return false; // ThÃªm check nÃ y
     }
     ```
   - Server cÃ³ thá»ƒ tráº£ vá» message lá»—i chi tiáº¿t hÆ¡n (thay vÃ¬ chá»‰ `return false`):
     ```java
     // CÃ³ thá»ƒ táº¡o enum hoáº·c exception Ä‘á»ƒ phÃ¢n biá»‡t loáº¡i lá»—i
     // VÃ­ dá»¥: INVALID_AMOUNT, ACCOUNT_NOT_FOUND, INSUFFICIENT_BALANCE
     ```
   - Client cÃ³ thá»ƒ hiá»ƒn thá»‹ message lá»—i tá»« server (náº¿u server tráº£ vá» message)

6. **Káº¿t luáº­n cho trÃ¬nh bÃ y**:
   - "ChÃºng ta validate á»Ÿ cáº£ 2 nÆ¡i vÃ¬ má»—i nÆ¡i cÃ³ má»¥c Ä‘Ã­ch khÃ¡c nhau"
   - "Client validation = UX tá»‘t, Server validation = Báº£o máº­t báº¯t buá»™c"
   - "ÄÃ¢y lÃ  nguyÃªn táº¯c Defense in Depth - phÃ²ng thá»§ nhiá»u lá»›p trong báº£o máº­t"
   - "Trong thá»±c táº¿, server validation lÃ  QUAN TRá»ŒNG NHáº¤T, client validation chá»‰ lÃ  'nice to have'"

10. RMI Stub - Giáº£i thÃ­ch chi tiáº¿t
----------------------------------
Stub lÃ  Ä‘á»‘i tÆ°á»£ng proxy Ä‘Æ°á»£c RMI tá»± Ä‘á»™ng táº¡o Ä‘á»ƒ client giao tiáº¿p vá»›i server.

ğŸ“ Stub lÃ  gÃ¬:
- Proxy object Ä‘áº¡i diá»‡n cho remote object trÃªn server
- Client khÃ´ng gá»i trá»±c tiáº¿p BankingImpl, mÃ  gá»i qua stub
- Stub xá»­ lÃ½ serialization, network communication tá»± Ä‘á»™ng

ğŸ“ Stub Ä‘Æ°á»£c táº¡o á»Ÿ Ä‘Ã¢u:
- Tá»± Ä‘á»™ng táº¡o khi server bind: `registry.bind("BankingService", bankingService)`
- LÆ°u trong Registry, client nháº­n khi lookup: `Naming.lookup("BankingService")`
- File stub: `BankingImpl_Stub.class` trong thÆ° má»¥c build output

ğŸ“ Stub Ä‘Æ°á»£c dÃ¹ng á»Ÿ Ä‘Ã¢u trong code:
- `ClientServiceImpl.java` dÃ²ng 50: `bankingService = (IBanking) Naming.lookup(...)`
- Biáº¿n `bankingService` chá»©a stub, khÃ´ng pháº£i BankingImpl tháº­t
- Má»i method call (`deposit`, `withdraw`, `transfer`) Ä‘á»u Ä‘i qua stub

Xem file `RMI_STUB_EXPLANATION.txt` Ä‘á»ƒ hiá»ƒu chi tiáº¿t vá» stub!

ChÃºc báº¡n há»c tá»‘t vÃ  hiá»ƒu rÃµ cÃ¡ch BankingRMI hoáº¡t Ä‘á»™ng! Náº¿u cáº§n má»Ÿ rá»™ng thÃªm pháº§n nÃ o, hÃ£y ghi chÃº láº¡i trá»±c tiáº¿p trong file nÃ y Ä‘á»ƒ tiá»‡n theo dÃµi.

